"use strict";var e=require("../../chunks/three-platformize.js");class t{constructor(e,t){this.parts=e,this.options=t}}for(var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=new Uint8Array(256),a=0;a<n.length;a++)r[n.charCodeAt(a)]=a;class s{createObjectURL(e){if(e instanceof t){const t=function(e){for(var t,r="",a=new Uint8Array(e),s=a.byteLength,o=s%3,i=s-o,c=0;c<i;c+=3)t=a[c]<<16|a[c+1]<<8|a[c+2],r+=n[(16515072&t)>>18]+n[(258048&t)>>12]+n[(4032&t)>>6]+n[63&t];return 1==o?(t=a[i],r+=n[(252&t)>>2]+n[(3&t)<<4]+"=="):2==o&&(t=a[i]<<8|a[i+1],r+=n[(64512&t)>>10]+n[(1008&t)>>4]+n[(15&t)<<2]+"="),r}(e.parts[0]);return`data:${e.options.type};base64,${t}`}return""}revokeObjectURL(){}}function o(e){if((e=(e=`${e}`).replace(/[ \t\n\f\r]/g,"")).length%4==0&&(e=e.replace(/==?$/,"")),e.length%4==1||/[^+/0-9A-Za-z]/.test(e))return null;let t="",n=0,r=0;for(let a=0;a<e.length;a++)n<<=6,n|=i(e[a]),r+=6,24===r&&(t+=String.fromCharCode((16711680&n)>>16),t+=String.fromCharCode((65280&n)>>8),t+=String.fromCharCode(255&n),n=r=0);return 12===r?(n>>=4,t+=String.fromCharCode(n)):18===r&&(n>>=2,t+=String.fromCharCode((65280&n)>>8),t+=String.fromCharCode(255&n)),t}function i(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e);return t<0?void 0:t}const c=new WeakMap;class l{constructor(e){this.identifier=e.identifier,this.force=void 0===e.force?1:e.force,this.pageX=void 0===e.pageX?e.x:e.pageX,this.pageY=void 0===e.pageY?e.y:e.pageY,this.clientX=void 0===e.clientX?e.x:e.clientX,this.clientY=void 0===e.clientY?e.y:e.clientY,this.screenX=this.pageX,this.screenY=this.pageY}}class u{constructor(){c.set(this,{})}addEventListener(e,t,n={}){let r=c.get(this);r||(r={},c.set(this,r)),r[e]||(r[e]=[]),r[e].push(t),n.capture,n.once,n.passive}removeEventListener(e,t){const n=c.get(this);if(n){const r=n[e];if(r&&r.length>0)for(let e=r.length;e--;e>0)if(r[e]===t){r.splice(e,1);break}}}dispatchEvent(e={}){"function"!=typeof e.preventDefault&&(e.preventDefault=()=>{}),"function"!=typeof e.stopPropagation&&(e.stopPropagation=()=>{});const t=c.get(this);if(t){const n=t[e.type];if(n)for(let t=0;t<n.length;t++)n[t](e)}}}const h=new WeakMap,p=new WeakMap,d=new WeakMap;function m(e,t={}){t.target=t.target||this,"function"==typeof this[`on${e}`]&&this[`on${e}`].call(this,t)}function f(e,t={}){this.readyState=e,t.readyState=e,m.call(this,"readystatechange",t)}const{platform:g}=wx.getSystemInfoSync();class v extends u{constructor(){super(),this.onabort=null,this.onerror=null,this.onload=null,this.onloadstart=null,this.onprogress=null,this.ontimeout=null,this.onloadend=null,this.onreadystatechange=null,this.readyState=0,this.response=null,this.responseText=null,this.responseType="text",this.dataType="string",this.responseXML=null,this.status=0,this.statusText="",this.upload={},this.withCredentials=!1,h.set(this,{"content-type":"application/x-www-form-urlencoded"}),p.set(this,{})}abort(){const e=d.get(this);e&&e.abort()}getAllResponseHeaders(){const e=p.get(this);return Object.keys(e).map((t=>`${t}: ${e[t]}`)).join("\n")}getResponseHeader(e){return p.get(this)[e]}open(e,t){this._method=e,this._url=t,f.call(this,v.OPENED)}overrideMimeType(){}send(e=""){if(this.readyState!==v.OPENED)throw new Error("Failed to execute 'send' on 'XMLHttpRequest': The object's state must be OPENED.");{const n=this._url,r=h.get(this),a=this.responseType,s=this.dataType,o=function(e){return!/^(http|https|ftp|wxfile):\/\/.*/i.test(e)}(n);let i;"arraybuffer"===a||(i="utf8"),delete this.response,this.response=null;let c=!1;const l=({data:e,statusCode:t,header:n})=>{if(!c){if(c=!0,t=void 0===t?200:t,"string"!=typeof e&&!(e instanceof ArrayBuffer))try{e=JSON.stringify(e)}catch(e){}this.status=t,n&&p.set(this,n),m.call(this,"loadstart"),f.call(this,v.HEADERS_RECEIVED),f.call(this,v.LOADING),this.response=e,e instanceof ArrayBuffer?Object.defineProperty(this,"responseText",{enumerable:!0,configurable:!0,get:function(){throw"InvalidStateError : responseType is "+this.responseType}}):this.responseText=e,f.call(this,v.DONE),m.call(this,"load"),m.call(this,"loadend")}},u=({errMsg:e})=>{-1!==e.indexOf("abort")?m.call(this,"abort"):m.call(this,"error",{message:e}),m.call(this,"loadend"),o&&console.warn(e)};if(o){const e=wx.getFileSystemManager();var t={filePath:n,success:l,fail:u};return i&&(t.encoding=i),void e.readFile(t)}const d="arraybuffer"===a&&"ios"===g&&v.useFetchPatch;wx.request({data:e,url:n,method:this._method,header:r,dataType:s,responseType:a,enableCache:!1,success:l,fail:u}),d&&setTimeout((function(){wx.request({data:e,url:n,method:this._method,header:r,dataType:s,responseType:a,enableCache:!0,success:l,fail:u})}),v.fetchPatchDelay)}}setRequestHeader(e,t){const n=h.get(this);n[e]=t,h.set(this,n)}addEventListener(e,t){"function"==typeof t&&(this["on"+e]=(e={})=>{e.target=e.target||this,t.call(this,e)})}removeEventListener(e,t){this["on"+e]===t&&(this["on"+e]=null)}}function y(e){return e=(e=e.trim()).replace(/<!--[\s\S]*?-->/g,""),{declaration:t(),root:n()};function t(){if(!a(/^<\?xml\s*/))return;const e={attributes:{}};for(;!s()&&!o("?>");){const t=r();if(!t)return e;e.attributes[t.name]=t.value}return a(/\?>\s*/),a(/<!DOCTYPE[^>]*>\s/),e}function n(){const e=a(/^<([\w-:.]+)\s*/);if(!e)return;const t={name:e[1],attributes:{},children:[]};for(;!(s()||o(">")||o("?>")||o("/>"));){const e=r();if(!e)return t;t.attributes[e.name]=e.value}if(a(/^\s*\/>\s*/))return t;let i;for(a(/\??>\s*/),t.content=function(){const e=a(/^([^<]*)/);return e?e[1]:""}();i=n();)t.children.push(i);return a(/^<\/[\w-:.]+>\s*/),t}function r(){const e=a(/([\w:-]+)\s*=\s*("[^"]*"|'[^']*'|\w+)\s*/);var t;if(e)return{name:e[1],value:(t=e[2],t.replace(/^['"]|['"]$/g,""))}}function a(t){const n=e.match(t);if(n)return e=e.slice(n[0].length),n}function s(){return 0==e.length}function o(t){return 0==e.indexOf(t)}}function T(e,t){t(e),e.children.forEach((e=>T(e,t)))}v.UNSEND=0,v.OPENED=1,v.HEADERS_RECEIVED=2,v.LOADING=3,v.DONE=4,v.useFetchPatch=!1,v.fetchPatchDelay=200;class b{parseFromString(e){const t=y(e),n={hasAttribute(e){return void 0!==this.attributes[e]},getAttribute(e){return this.attributes[e]},getElementsByTagName(e){const t=[];return this.childNodes.forEach((n=>T(n,(n=>e===n.name&&t.push(n))))),t}};T(t.root,(e=>{e.nodeType=1,e.nodeName=e.name,e.style=new Proxy((e.attributes.style||"").split(";").reduce(((e,t)=>{if(t){let[n,r]=t.split(":");e[n.trim()]=r.trim()}return e}),{}),{get:(e,t)=>e[t]||""}),e.textContent=e.content,e.childNodes=e.children,e.__proto__=n}));const r={documentElement:t.root,childNodes:[t.root]};return r.__proto__=n,r}}class E{decode(e){let t="";for(let n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}}}function w(){return wx.createOffscreenCanvas()}class x{constructor(e,t,n){const r=wx.getSystemInfoSync(),a="android"===r.platform;this.canvas=e,this.canvasW=void 0===t?e.width:t,this.canvasH=void 0===n?e.height:n,this.document={createElementNS:(t,n)=>"canvas"===n?e:"img"===n?e.createImage():void 0},this.window={innerWidth:r.windowWidth,innerHeight:r.windowHeight,devicePixelRatio:r.pixelRatio,URL:new s,AudioContext:function(){},requestAnimationFrame:this.canvas.requestAnimationFrame,cancelAnimationFrame:this.canvas.cancelAnimationFrame,DeviceOrientationEvent:{requestPermission:()=>Promise.resolve("granted")},DOMParser:b,TextDecoder:E},[this.canvas,this.document,this.window].forEach((e=>{const t=e.__proto__;e.__proto__={},e.__proto__.__proto__=t,function(e,t){for(let n of Object.getOwnPropertyNames(t))if("constructor"!==n&&"prototype"!==n&&"name"!==n){let r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r)}}(e.__proto__,u.prototype)})),this.patchCanvas(),this.onDeviceMotionChange=e=>{e.type="deviceorientation",a&&(e.alpha*=-1,e.beta*=-1,e.gamma*=-1),this.window.dispatchEvent(e)}}patchCanvas(){const{canvasH:e,canvasW:t}=this;Object.defineProperty(this.canvas,"style",{get(){return{width:this.width+"px",height:this.height+"px"}}}),Object.defineProperty(this.canvas,"clientHeight",{get(){return e||this.height}}),Object.defineProperty(this.canvas,"clientWidth",{get(){return t||this.width}}),this.canvas.ownerDocument=this.document}patchXHR(){return v.useFetchPatch=!0,this}getGlobals(){return{atob:o,Blob:t,window:this.window,document:this.document,HTMLCanvasElement:void 0,XMLHttpRequest:v,OffscreenCanvas:w,createImageBitmap:void 0}}enableDeviceOrientation(e){return new Promise(((t,n)=>{wx.onDeviceMotionChange(this.onDeviceMotionChange),wx.startDeviceMotionListening({interval:e,success:e=>{t(e),this.enabledDeviceMotion=!0},fail:n})}))}disableDeviceOrientation(){return new Promise(((e,t)=>{wx.offDeviceMotionChange(this.onDeviceMotionChange),this.enabledDeviceMotion&&wx.stopDeviceMotionListening({success:()=>{e(),this.enabledDeviceMotion=!1},fail:t})}))}dispatchTouchEvent(e={}){const t={...this},n={changedTouches:e.changedTouches.map((e=>new l(e))),touches:e.touches.map((e=>new l(e))),targetTouches:Array.prototype.slice.call(e.touches.map((e=>new l(e)))),timeStamp:e.timeStamp,target:t,currentTarget:t,type:e.type,cancelBubble:!1,cancelable:!1};this.canvas.dispatchEvent(n)}dispose(){this.disableDeviceOrientation(),this.canvas.width=0,this.canvas.height=0,this.canvas&&(this.canvas.ownerDocument=null),this.onDeviceMotionChange=null,this.document=null,this.window=null,this.canvas=null}}var M=function(){function t(t){e.Loader.call(this,t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new o(e)})),this.register((function(e){return new c(e)})),this.register((function(e){return new l(e)})),this.register((function(e){return new i(e)})),this.register((function(e){return new a(e)})),this.register((function(e){return new u(e)}))}function n(){var e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}t.prototype=Object.assign(Object.create(e.Loader.prototype),{constructor:t,load:function(t,n,r,a){var s,o=this;s=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:e.LoaderUtils.extractUrlBase(t),this.manager.itemStart(t);var i=function(e){a?a(e):console.error(e),o.manager.itemError(t),o.manager.itemEnd(t)},c=new e.FileLoader(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(t,(function(e){try{o.parse(e,s,(function(e){n(e),o.manager.itemEnd(t)}),i)}catch(e){i(e)}}),r,i)},setDRACOLoader:function(e){return this.dracoLoader=e,this},setDDSLoader:function(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')},setKTX2Loader:function(e){return this.ktx2Loader=e,this},setMeshoptDecoder:function(e){return this.meshoptDecoder=e,this},register:function(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this},unregister:function(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this},parse:function(t,n,a,o){var i,c={},l={};if("string"==typeof t)i=t;else if(e.LoaderUtils.decodeText(new Uint8Array(t,0,4))===h){try{c[r.KHR_BINARY_GLTF]=new m(t)}catch(e){return void(o&&o(e))}i=c[r.KHR_BINARY_GLTF].content}else i=e.LoaderUtils.decodeText(new Uint8Array(t));var u=JSON.parse(i);if(void 0===u.asset||u.asset.version[0]<2)o&&o(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var p=new V(u,{path:n||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});p.fileLoader.setRequestHeader(this.requestHeader);for(var d=0;d<this.pluginCallbacks.length;d++){var v=this.pluginCallbacks[d](p);l[v.name]=v,c[v.name]=!0}if(u.extensionsUsed)for(d=0;d<u.extensionsUsed.length;++d){var b=u.extensionsUsed[d],E=u.extensionsRequired||[];switch(b){case r.KHR_MATERIALS_UNLIT:c[b]=new s;break;case r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:c[b]=new y;break;case r.KHR_DRACO_MESH_COMPRESSION:c[b]=new f(u,this.dracoLoader);break;case r.KHR_TEXTURE_TRANSFORM:c[b]=new g;break;case r.KHR_MESH_QUANTIZATION:c[b]=new T;break;default:E.indexOf(b)>=0&&void 0===l[b]&&console.warn('THREE.GLTFLoader: Unknown extension "'+b+'".')}}p.setExtensions(c),p.setPlugins(l),p.parse(a,o)}}});var r={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};function a(e){this.parser=e,this.name=r.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}function s(){this.name=r.KHR_MATERIALS_UNLIT}function o(e){this.parser=e,this.name=r.KHR_MATERIALS_CLEARCOAT}function i(e){this.parser=e,this.name=r.KHR_MATERIALS_TRANSMISSION}function c(e){this.parser=e,this.name=r.KHR_TEXTURE_BASISU}function l(e){this.parser=e,this.name=r.EXT_TEXTURE_WEBP,this.isSupported=null}function u(e){this.name=r.EXT_MESHOPT_COMPRESSION,this.parser=e}a.prototype._markDefs=function(){for(var e=this.parser,t=this.parser.json.nodes||[],n=0,r=t.length;n<r;n++){var a=t[n];a.extensions&&a.extensions[this.name]&&void 0!==a.extensions[this.name].light&&e._addNodeRef(this.cache,a.extensions[this.name].light)}},a.prototype._loadLight=function(t){var n=this.parser,r="light:"+t,a=n.cache.get(r);if(a)return a;var s,o=n.json,i=((o.extensions&&o.extensions[this.name]||{}).lights||[])[t],c=new e.Color(16777215);void 0!==i.color&&c.fromArray(i.color);var l=void 0!==i.range?i.range:0;switch(i.type){case"directional":(s=new e.DirectionalLight(c)).target.position.set(0,0,-1),s.add(s.target);break;case"point":(s=new e.PointLight(c)).distance=l;break;case"spot":(s=new e.SpotLight(c)).distance=l,i.spot=i.spot||{},i.spot.innerConeAngle=void 0!==i.spot.innerConeAngle?i.spot.innerConeAngle:0,i.spot.outerConeAngle=void 0!==i.spot.outerConeAngle?i.spot.outerConeAngle:Math.PI/4,s.angle=i.spot.outerConeAngle,s.penumbra=1-i.spot.innerConeAngle/i.spot.outerConeAngle,s.target.position.set(0,0,-1),s.add(s.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+i.type)}return s.position.set(0,0,0),s.decay=2,void 0!==i.intensity&&(s.intensity=i.intensity),s.name=n.createUniqueName(i.name||"light_"+t),a=Promise.resolve(s),n.cache.add(r,a),a},a.prototype.createNodeAttachment=function(e){var t=this,n=this.parser,r=n.json.nodes[e],a=(r.extensions&&r.extensions[this.name]||{}).light;return void 0===a?null:this._loadLight(a).then((function(e){return n._getNodeRef(t.cache,a,e)}))},s.prototype.getMaterialType=function(){return e.MeshBasicMaterial},s.prototype.extendParams=function(t,n,r){var a=[];t.color=new e.Color(1,1,1),t.opacity=1;var s=n.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){var o=s.baseColorFactor;t.color.fromArray(o),t.opacity=o[3]}void 0!==s.baseColorTexture&&a.push(r.assignTexture(t,"map",s.baseColorTexture))}return Promise.all(a)},o.prototype.getMaterialType=function(t){var n=this.parser.json.materials[t];return n.extensions&&n.extensions[this.name]?e.MeshPhysicalMaterial:null},o.prototype.extendMaterialParams=function(t,n){var r=this.parser,a=r.json.materials[t];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();var s=[],o=a.extensions[this.name];if(void 0!==o.clearcoatFactor&&(n.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&s.push(r.assignTexture(n,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(n.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&s.push(r.assignTexture(n,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(s.push(r.assignTexture(n,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){var i=o.clearcoatNormalTexture.scale;n.clearcoatNormalScale=new e.Vector2(i,-i)}return Promise.all(s)},i.prototype.getMaterialType=function(t){var n=this.parser.json.materials[t];return n.extensions&&n.extensions[this.name]?e.MeshPhysicalMaterial:null},i.prototype.extendMaterialParams=function(e,t){var n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var a=[],s=r.extensions[this.name];return void 0!==s.transmissionFactor&&(t.transmission=s.transmissionFactor),void 0!==s.transmissionTexture&&a.push(n.assignTexture(t,"transmissionMap",s.transmissionTexture)),Promise.all(a)},c.prototype.loadTexture=function(e){var t=this.parser,n=t.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;var a=r.extensions[this.name],s=n.images[a.source],o=t.options.ktx2Loader;if(!o){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s,o)},l.prototype.loadTexture=function(e){var t=this.name,n=this.parser,r=n.json,a=r.textures[e];if(!a.extensions||!a.extensions[t])return null;var s=a.extensions[t],o=r.images[s.source],i=n.textureLoader;if(o.uri){var c=n.options.manager.getHandler(o.uri);null!==c&&(i=c)}return this.detectSupport().then((function(a){if(a)return n.loadTextureImage(e,o,i);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)}))},l.prototype.detectSupport=function(){return this.isSupported||(this.isSupported=new Promise((function(e){var t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported},u.prototype.loadBufferView=function(e){var t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){var r=n.extensions[this.name],a=this.parser.getDependency("buffer",r.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([a,s.ready]).then((function(e){var t=r.byteOffset||0,n=r.byteLength||0,a=r.count,o=r.byteStride,i=new ArrayBuffer(a*o),c=new Uint8Array(e[0],t,n);return s.decodeGltfBuffer(new Uint8Array(i),a,o,c,r.mode,r.filter),i}))}return null};var h="glTF",p=1313821514,d=5130562;function m(t){this.name=r.KHR_BINARY_GLTF,this.content=null,this.body=null;var n=new DataView(t,0,12);if(this.header={magic:e.LoaderUtils.decodeText(new Uint8Array(t.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==h)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var a=this.header.length-12,s=new DataView(t,12),o=0;o<a;){var i=s.getUint32(o,!0);o+=4;var c=s.getUint32(o,!0);if(o+=4,c===p){var l=new Uint8Array(t,12+o,i);this.content=e.LoaderUtils.decodeText(l)}else if(c===d){var u=12+o;this.body=t.slice(u,u+i)}o+=i}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function f(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=r.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}function g(){this.name=r.KHR_TEXTURE_TRANSFORM}function v(t){e.MeshStandardMaterial.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var n=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),r=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),a=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),s=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),i={specular:{value:(new e.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=i,this.onBeforeCompile=function(e){for(var t in i)e.uniforms[t]=i[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",n).replace("#include <metalnessmap_pars_fragment>",r).replace("#include <roughnessmap_fragment>",a).replace("#include <metalnessmap_fragment>",s).replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return i.specular.value},set:function(e){i.specular.value=e}},specularMap:{get:function(){return i.specularMap.value},set:function(e){i.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return i.glossiness.value},set:function(e){i.glossiness.value=e}},glossinessMap:{get:function(){return i.glossinessMap.value},set:function(e){i.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(t)}function y(){return{name:r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return v},extendParams:function(t,n,r){var a=n.extensions[this.name];t.color=new e.Color(1,1,1),t.opacity=1;var s=[];if(Array.isArray(a.diffuseFactor)){var o=a.diffuseFactor;t.color.fromArray(o),t.opacity=o[3]}if(void 0!==a.diffuseTexture&&s.push(r.assignTexture(t,"map",a.diffuseTexture)),t.emissive=new e.Color(0,0,0),t.glossiness=void 0!==a.glossinessFactor?a.glossinessFactor:1,t.specular=new e.Color(1,1,1),Array.isArray(a.specularFactor)&&t.specular.fromArray(a.specularFactor),void 0!==a.specularGlossinessTexture){var i=a.specularGlossinessTexture;s.push(r.assignTexture(t,"glossinessMap",i)),s.push(r.assignTexture(t,"specularMap",i))}return Promise.all(s)},createMaterial:function(t){var n=new v(t);return n.fog=!0,n.color=t.color,n.map=void 0===t.map?null:t.map,n.lightMap=null,n.lightMapIntensity=1,n.aoMap=void 0===t.aoMap?null:t.aoMap,n.aoMapIntensity=1,n.emissive=t.emissive,n.emissiveIntensity=1,n.emissiveMap=void 0===t.emissiveMap?null:t.emissiveMap,n.bumpMap=void 0===t.bumpMap?null:t.bumpMap,n.bumpScale=1,n.normalMap=void 0===t.normalMap?null:t.normalMap,n.normalMapType=e.TangentSpaceNormalMap,t.normalScale&&(n.normalScale=t.normalScale),n.displacementMap=null,n.displacementScale=1,n.displacementBias=0,n.specularMap=void 0===t.specularMap?null:t.specularMap,n.specular=t.specular,n.glossinessMap=void 0===t.glossinessMap?null:t.glossinessMap,n.glossiness=t.glossiness,n.alphaMap=null,n.envMap=void 0===t.envMap?null:t.envMap,n.envMapIntensity=1,n.refractionRatio=.98,n}}}function T(){this.name=r.KHR_MESH_QUANTIZATION}function b(t,n,r,a){e.Interpolant.call(this,t,n,r,a)}f.prototype.decodePrimitive=function(e,t){var n=this.json,r=this.dracoLoader,a=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,o={},i={},c={};for(var l in s){var u=C[l]||l.toLowerCase();o[u]=s[l]}for(l in e.attributes){u=C[l]||l.toLowerCase();if(void 0!==s[l]){var h=n.accessors[e.attributes[l]],p=L[h.componentType];c[u]=p,i[u]=!0===h.normalized}}return t.getDependency("bufferView",a).then((function(e){return new Promise((function(t){r.decodeDracoFile(e,(function(e){for(var n in e.attributes){var r=e.attributes[n],a=i[n];void 0!==a&&(r.normalized=a)}t(e)}),o,c)}))}))},g.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},v.prototype=Object.create(e.MeshStandardMaterial.prototype),v.prototype.constructor=v,v.prototype.copy=function(t){return e.MeshStandardMaterial.prototype.copy.call(this,t),this.specularMap=t.specularMap,this.specular.copy(t.specular),this.glossinessMap=t.glossinessMap,this.glossiness=t.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},b.prototype=Object.create(e.Interpolant.prototype),b.prototype.constructor=b,b.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,a=e*r*3+r,s=0;s!==r;s++)t[s]=n[a+s];return t},b.prototype.beforeStart_=b.prototype.copySampleValue_,b.prototype.afterEnd_=b.prototype.copySampleValue_,b.prototype.interpolate_=function(e,t,n,r){for(var a=this.resultBuffer,s=this.sampleValues,o=this.valueSize,i=2*o,c=3*o,l=r-t,u=(n-t)/l,h=u*u,p=h*u,d=e*c,m=d-c,f=-2*p+3*h,g=p-h,v=1-f,y=g-h+u,T=0;T!==o;T++){var b=s[m+T+o],E=s[m+T+i]*l,w=s[d+T+o],x=s[d+T]*l;a[T]=v*b+y*E+f*w+g*x}return a};var E=0,w=1,x=2,M=3,R=4,A=5,S=6,L={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},_={9728:e.NearestFilter,9729:e.LinearFilter,9984:e.NearestMipmapNearestFilter,9985:e.LinearMipmapNearestFilter,9986:e.NearestMipmapLinearFilter,9987:e.LinearMipmapLinearFilter},O={33071:e.ClampToEdgeWrapping,33648:e.MirroredRepeatWrapping,10497:e.RepeatWrapping},P={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},C={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},N={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},I={CUBICSPLINE:void 0,LINEAR:e.InterpolateLinear,STEP:e.InterpolateDiscrete},D="OPAQUE",H="MASK",U="BLEND";function F(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}function k(e,t,n){for(var r in n.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=n.extensions[r])}function j(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function B(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var n=0,r=t.weights.length;n<r;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){var a=t.extras.targetNames;if(e.morphTargetInfluences.length===a.length){e.morphTargetDictionary={};for(n=0,r=a.length;n<r;n++)e.morphTargetDictionary[a[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function G(e){for(var t="",n=Object.keys(e).sort(),r=0,a=n.length;r<a;r++)t+=n[r]+":"+e[n[r]]+";";return t}function V(t,r){this.json=t||{},this.extensions={},this.plugins={},this.options=r||{},this.cache=new n,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.nodeNamesUsed={},void 0!==e.$createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new e.ImageBitmapLoader(this.options.manager):this.textureLoader=new e.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new e.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function K(t,n,r){var a=n.attributes,s=[];function o(e,n){return r.getDependency("accessor",e).then((function(e){t.setAttribute(n,e)}))}for(var i in a){var c=C[i]||i.toLowerCase();c in t.attributes||s.push(o(a[i],c))}if(void 0!==n.indices&&!t.index){var l=r.getDependency("accessor",n.indices).then((function(e){t.setIndex(e)}));s.push(l)}return j(t,n),function(t,n,r){var a=n.attributes,s=new e.Box3;if(void 0!==a.POSITION){var o=(d=r.json.accessors[a.POSITION]).min,i=d.max;if(void 0!==o&&void 0!==i){s.set(new e.Vector3(o[0],o[1],o[2]),new e.Vector3(i[0],i[1],i[2]));var c=n.targets;if(void 0!==c){for(var l=new e.Vector3,u=new e.Vector3,h=0,p=c.length;h<p;h++){var d,m=c[h];if(void 0!==m.POSITION)o=(d=r.json.accessors[m.POSITION]).min,i=d.max,void 0!==o&&void 0!==i?(u.setX(Math.max(Math.abs(o[0]),Math.abs(i[0]))),u.setY(Math.max(Math.abs(o[1]),Math.abs(i[1]))),u.setZ(Math.max(Math.abs(o[2]),Math.abs(i[2]))),l.max(u)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}s.expandByVector(l)}t.boundingBox=s;var f=new e.Sphere;s.getCenter(f.center),f.radius=s.min.distanceTo(s.max)/2,t.boundingSphere=f}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(t,n,r),Promise.all(s).then((function(){return void 0!==n.targets?function(e,t,n){for(var r=!1,a=!1,s=0,o=t.length;s<o&&(void 0!==(l=t[s]).POSITION&&(r=!0),void 0!==l.NORMAL&&(a=!0),!r||!a);s++);if(!r&&!a)return Promise.resolve(e);var i=[],c=[];for(s=0,o=t.length;s<o;s++){var l=t[s];if(r){var u=void 0!==l.POSITION?n.getDependency("accessor",l.POSITION):e.attributes.position;i.push(u)}a&&(u=void 0!==l.NORMAL?n.getDependency("accessor",l.NORMAL):e.attributes.normal,c.push(u))}return Promise.all([Promise.all(i),Promise.all(c)]).then((function(t){var n=t[0],s=t[1];return r&&(e.morphAttributes.position=n),a&&(e.morphAttributes.normal=s),e.morphTargetsRelative=!0,e}))}(t,n.targets,r):t}))}function X(t,n){var r=t.getIndex();if(null===r){var a=[],s=t.getAttribute("position");if(void 0===s)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(var o=0;o<s.count;o++)a.push(o);t.setIndex(a),r=t.getIndex()}var i=r.count-2,c=[];if(n===e.TriangleFanDrawMode)for(o=1;o<=i;o++)c.push(r.getX(0)),c.push(r.getX(o)),c.push(r.getX(o+1));else for(o=0;o<i;o++)o%2==0?(c.push(r.getX(o)),c.push(r.getX(o+1)),c.push(r.getX(o+2))):(c.push(r.getX(o+2)),c.push(r.getX(o+1)),c.push(r.getX(o)));c.length/3!==i&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var l=t.clone();return l.setIndex(c),l}return V.prototype.setExtensions=function(e){this.extensions=e},V.prototype.setPlugins=function(e){this.plugins=e},V.prototype.parse=function(e,t){var n=this,r=this.json,a=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(t){var s={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:r.asset,parser:n,userData:{}};k(a,s,r),j(s,r),Promise.all(n._invokeAll((function(e){return e.afterRoot&&e.afterRoot(s)}))).then((function(){e(s)}))})).catch(t)},V.prototype._markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[],r=0,a=t.length;r<a;r++)for(var s=t[r].joints,o=0,i=s.length;o<i;o++)e[s[o]].isBone=!0;for(var c=0,l=e.length;c<l;c++){var u=e[c];void 0!==u.mesh&&(this._addNodeRef(this.meshCache,u.mesh),void 0!==u.skin&&(n[u.mesh].isSkinnedMesh=!0)),void 0!==u.camera&&this._addNodeRef(this.cameraCache,u.camera)}},V.prototype._addNodeRef=function(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)},V.prototype._getNodeRef=function(e,t,n){if(e.refs[t]<=1)return n;var r=n.clone();return r.name+="_instance_"+e.uses[t]++,r},V.prototype._invokeOne=function(e){var t=Object.values(this.plugins);t.push(this);for(var n=0;n<t.length;n++){var r=e(t[n]);if(r)return r}},V.prototype._invokeAll=function(e){var t=Object.values(this.plugins);t.unshift(this);for(var n=[],r=0;r<t.length;r++){var a=e(t[r]);a&&n.push(a)}return n},V.prototype.getDependency=function(e,t){var n=e+":"+t,r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":r=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":r=this.loadSkin(t);break;case"animation":r=this.loadAnimation(t);break;case"camera":r=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,r)}return r},V.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var n=this,r=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(r.map((function(t,r){return n.getDependency(e,r)}))),this.cache.add(e,t)}return t},V.prototype.loadBuffer=function(e){var t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[r.KHR_BINARY_GLTF].body);var a=this.options;return new Promise((function(e,r){n.load(F(t.uri,a.path),e,void 0,(function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))},V.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){var n=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+n)}))},V.prototype.loadAccessor=function(t){var n=this,r=this.json,a=this.json.accessors[t];if(void 0===a.bufferView&&void 0===a.sparse)return Promise.resolve(null);var s=[];return void 0!==a.bufferView?s.push(this.getDependency("bufferView",a.bufferView)):s.push(null),void 0!==a.sparse&&(s.push(this.getDependency("bufferView",a.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",a.sparse.values.bufferView))),Promise.all(s).then((function(t){var s,o,i=t[0],c=P[a.type],l=L[a.componentType],u=l.BYTES_PER_ELEMENT,h=u*c,p=a.byteOffset||0,d=void 0!==a.bufferView?r.bufferViews[a.bufferView].byteStride:void 0,m=!0===a.normalized;if(d&&d!==h){var f=Math.floor(p/d),g="InterleavedBuffer:"+a.bufferView+":"+a.componentType+":"+f+":"+a.count,v=n.cache.get(g);v||(s=new l(i,f*d,a.count*d/u),v=new e.InterleavedBuffer(s,d/u),n.cache.add(g,v)),o=new e.InterleavedBufferAttribute(v,c,p%d/u,m)}else s=null===i?new l(a.count*c):new l(i,p,a.count*c),o=new e.BufferAttribute(s,c,m);if(void 0!==a.sparse){var y=P.SCALAR,T=L[a.sparse.indices.componentType],b=a.sparse.indices.byteOffset||0,E=a.sparse.values.byteOffset||0,w=new T(t[1],b,a.sparse.count*y),x=new l(t[2],E,a.sparse.count*c);null!==i&&(o=new e.BufferAttribute(o.array.slice(),o.itemSize,o.normalized));for(var M=0,R=w.length;M<R;M++){var A=w[M];if(o.setX(A,x[M*c]),c>=2&&o.setY(A,x[M*c+1]),c>=3&&o.setZ(A,x[M*c+2]),c>=4&&o.setW(A,x[M*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return o}))},V.prototype.loadTexture=function(e){var t=this.json,n=this.options,r=t.textures[e],a=t.images[r.source],s=this.textureLoader;if(a.uri){var o=n.manager.getHandler(a.uri);null!==o&&(s=o)}return this.loadTextureImage(e,a,s)},V.prototype.loadTextureImage=function(t,n,r){var a=this,s=this.json,o=this.options,i=s.textures[t],c=e.$URL||self.webkitURL,l=n.uri,u=!1,h=!0;if("image/jpeg"===n.mimeType&&(h=!1),void 0!==n.bufferView)l=a.getDependency("bufferView",n.bufferView).then((function(t){if("image/png"===n.mimeType){var r=new DataView(t,25,1).getUint8(0,!1);h=6===r||4===r||3===r}u=!0;var a=new e.$Blob([t],{type:n.mimeType});return l=c.createObjectURL(a)}));else if(void 0===n.uri)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");return Promise.resolve(l).then((function(t){return new Promise((function(n,a){var s=n;!0===r.isImageBitmapLoader&&(s=function(t){n(new e.CanvasTexture(t))}),r.load(F(t,o.path),s,void 0,a)}))})).then((function(n){!0===u&&c.revokeObjectURL(l),n.flipY=!1,i.name&&(n.name=i.name),h||(n.format=e.RGBFormat);var r=(s.samplers||{})[i.sampler]||{};return n.magFilter=_[r.magFilter]||e.LinearFilter,n.minFilter=_[r.minFilter]||e.LinearMipmapLinearFilter,n.wrapS=O[r.wrapS]||e.RepeatWrapping,n.wrapT=O[r.wrapT]||e.RepeatWrapping,a.associations.set(n,{type:"textures",index:t}),n}))},V.prototype.assignTexture=function(e,t,n){var a=this;return this.getDependency("texture",n.index).then((function(s){if(void 0===n.texCoord||0==n.texCoord||"aoMap"===t&&1==n.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),a.extensions[r.KHR_TEXTURE_TRANSFORM]){var o=void 0!==n.extensions?n.extensions[r.KHR_TEXTURE_TRANSFORM]:void 0;if(o){var i=a.associations.get(s);s=a.extensions[r.KHR_TEXTURE_TRANSFORM].extendTexture(s,o),a.associations.set(s,i)}}e[t]=s}))},V.prototype.assignFinalMaterial=function(t){var n=t.geometry,r=t.material,a=void 0!==n.attributes.tangent,s=void 0!==n.attributes.color,o=void 0===n.attributes.normal,i=!0===t.isSkinnedMesh,c=Object.keys(n.morphAttributes).length>0,l=c&&void 0!==n.morphAttributes.normal;if(t.isPoints){var u="PointsMaterial:"+r.uuid,h=this.cache.get(u);h||(h=new e.PointsMaterial,e.Material.prototype.copy.call(h,r),h.color.copy(r.color),h.map=r.map,h.sizeAttenuation=!1,this.cache.add(u,h)),r=h}else if(t.isLine){u="LineBasicMaterial:"+r.uuid;var p=this.cache.get(u);p||(p=new e.LineBasicMaterial,e.Material.prototype.copy.call(p,r),p.color.copy(r.color),this.cache.add(u,p)),r=p}if(a||s||o||i||c){u="ClonedMaterial:"+r.uuid+":";r.isGLTFSpecularGlossinessMaterial&&(u+="specular-glossiness:"),i&&(u+="skinning:"),a&&(u+="vertex-tangents:"),s&&(u+="vertex-colors:"),o&&(u+="flat-shading:"),c&&(u+="morph-targets:"),l&&(u+="morph-normals:");var d=this.cache.get(u);d||(d=r.clone(),i&&(d.skinning=!0),s&&(d.vertexColors=!0),o&&(d.flatShading=!0),c&&(d.morphTargets=!0),l&&(d.morphNormals=!0),a&&(d.vertexTangents=!0,d.normalScale&&(d.normalScale.y*=-1),d.clearcoatNormalScale&&(d.clearcoatNormalScale.y*=-1)),this.cache.add(u,d),this.associations.set(d,this.associations.get(r))),r=d}r.aoMap&&void 0===n.attributes.uv2&&void 0!==n.attributes.uv&&n.setAttribute("uv2",n.attributes.uv),t.material=r},V.prototype.getMaterialType=function(){return e.MeshStandardMaterial},V.prototype.loadMaterial=function(t){var n,a=this,s=this.json,o=this.extensions,i=s.materials[t],c={},l=i.extensions||{},u=[];if(l[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var h=o[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];n=h.getMaterialType(),u.push(h.extendParams(c,i,a))}else if(l[r.KHR_MATERIALS_UNLIT]){var p=o[r.KHR_MATERIALS_UNLIT];n=p.getMaterialType(),u.push(p.extendParams(c,i,a))}else{var d=i.pbrMetallicRoughness||{};if(c.color=new e.Color(1,1,1),c.opacity=1,Array.isArray(d.baseColorFactor)){var m=d.baseColorFactor;c.color.fromArray(m),c.opacity=m[3]}void 0!==d.baseColorTexture&&u.push(a.assignTexture(c,"map",d.baseColorTexture)),c.metalness=void 0!==d.metallicFactor?d.metallicFactor:1,c.roughness=void 0!==d.roughnessFactor?d.roughnessFactor:1,void 0!==d.metallicRoughnessTexture&&(u.push(a.assignTexture(c,"metalnessMap",d.metallicRoughnessTexture)),u.push(a.assignTexture(c,"roughnessMap",d.metallicRoughnessTexture))),n=this._invokeOne((function(e){return e.getMaterialType&&e.getMaterialType(t)})),u.push(Promise.all(this._invokeAll((function(e){return e.extendMaterialParams&&e.extendMaterialParams(t,c)}))))}!0===i.doubleSided&&(c.side=e.DoubleSide);var f=i.alphaMode||D;return f===U?(c.transparent=!0,c.depthWrite=!1):(c.transparent=!1,f===H&&(c.alphaTest=void 0!==i.alphaCutoff?i.alphaCutoff:.5)),void 0!==i.normalTexture&&n!==e.MeshBasicMaterial&&(u.push(a.assignTexture(c,"normalMap",i.normalTexture)),c.normalScale=new e.Vector2(1,-1),void 0!==i.normalTexture.scale&&c.normalScale.set(i.normalTexture.scale,-i.normalTexture.scale)),void 0!==i.occlusionTexture&&n!==e.MeshBasicMaterial&&(u.push(a.assignTexture(c,"aoMap",i.occlusionTexture)),void 0!==i.occlusionTexture.strength&&(c.aoMapIntensity=i.occlusionTexture.strength)),void 0!==i.emissiveFactor&&n!==e.MeshBasicMaterial&&(c.emissive=(new e.Color).fromArray(i.emissiveFactor)),void 0!==i.emissiveTexture&&n!==e.MeshBasicMaterial&&u.push(a.assignTexture(c,"emissiveMap",i.emissiveTexture)),Promise.all(u).then((function(){var s;return s=n===v?o[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(c):new n(c),i.name&&(s.name=i.name),s.map&&(s.map.encoding=e.sRGBEncoding),s.emissiveMap&&(s.emissiveMap.encoding=e.sRGBEncoding),j(s,i),a.associations.set(s,{type:"materials",index:t}),i.extensions&&k(o,s,i),s}))},V.prototype.createUniqueName=function(t){for(var n=e.PropertyBinding.sanitizeNodeName(t||""),r=n,a=1;this.nodeNamesUsed[r];++a)r=n+"_"+a;return this.nodeNamesUsed[r]=!0,r},V.prototype.loadGeometries=function(t){var n=this,a=this.extensions,s=this.primitiveCache;function o(e){return a[r.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,n).then((function(t){return K(t,e,n)}))}for(var i,c,l=[],u=0,h=t.length;u<h;u++){var p,d=t[u],m=(c=void 0,(c=(i=d).extensions&&i.extensions[r.KHR_DRACO_MESH_COMPRESSION])?"draco:"+c.bufferView+":"+c.indices+":"+G(c.attributes):i.indices+":"+G(i.attributes)+":"+i.mode),f=s[m];if(f)l.push(f.promise);else p=d.extensions&&d.extensions[r.KHR_DRACO_MESH_COMPRESSION]?o(d):K(new e.BufferGeometry,d,n),s[m]={primitive:d,promise:p},l.push(p)}return Promise.all(l)},V.prototype.loadMesh=function(t){for(var n,r=this,a=this.json,s=this.extensions,o=a.meshes[t],i=o.primitives,c=[],l=0,u=i.length;l<u;l++){var h=void 0===i[l].material?(void 0===(n=this.cache).DefaultMaterial&&(n.DefaultMaterial=new e.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:e.FrontSide})),n.DefaultMaterial):this.getDependency("material",i[l].material);c.push(h)}return c.push(r.loadGeometries(i)),Promise.all(c).then((function(n){for(var a=n.slice(0,n.length-1),c=n[n.length-1],l=[],u=0,h=c.length;u<h;u++){var p,d=c[u],m=i[u],f=a[u];if(m.mode===R||m.mode===A||m.mode===S||void 0===m.mode)!0!==(p=!0===o.isSkinnedMesh?new e.SkinnedMesh(d,f):new e.Mesh(d,f)).isSkinnedMesh||p.geometry.attributes.skinWeight.normalized||p.normalizeSkinWeights(),m.mode===A?p.geometry=X(p.geometry,e.TriangleStripDrawMode):m.mode===S&&(p.geometry=X(p.geometry,e.TriangleFanDrawMode));else if(m.mode===w)p=new e.LineSegments(d,f);else if(m.mode===M)p=new e.Line(d,f);else if(m.mode===x)p=new e.LineLoop(d,f);else{if(m.mode!==E)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+m.mode);p=new e.Points(d,f)}Object.keys(p.geometry.morphAttributes).length>0&&B(p,o),p.name=r.createUniqueName(o.name||"mesh_"+t),j(p,o),m.extensions&&k(s,p,m),r.assignFinalMaterial(p),l.push(p)}if(1===l.length)return l[0];var g=new e.Group;for(u=0,h=l.length;u<h;u++)g.add(l[u]);return g}))},V.prototype.loadCamera=function(t){var n,r=this.json.cameras[t],a=r[r.type];if(a)return"perspective"===r.type?n=new e.PerspectiveCamera(e.MathUtils.radToDeg(a.yfov),a.aspectRatio||1,a.znear||1,a.zfar||2e6):"orthographic"===r.type&&(n=new e.OrthographicCamera(-a.xmag,a.xmag,a.ymag,-a.ymag,a.znear,a.zfar)),r.name&&(n.name=this.createUniqueName(r.name)),j(n,r),Promise.resolve(n);console.warn("THREE.GLTFLoader: Missing camera parameters.")},V.prototype.loadSkin=function(e){var t=this.json.skins[e],n={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return n.inverseBindMatrices=e,n}))},V.prototype.loadAnimation=function(t){for(var n=this.json.animations[t],r=[],a=[],s=[],o=[],i=[],c=0,l=n.channels.length;c<l;c++){var u=n.channels[c],h=n.samplers[u.sampler],p=u.target,d=void 0!==p.node?p.node:p.id,m=void 0!==n.parameters?n.parameters[h.input]:h.input,f=void 0!==n.parameters?n.parameters[h.output]:h.output;r.push(this.getDependency("node",d)),a.push(this.getDependency("accessor",m)),s.push(this.getDependency("accessor",f)),o.push(h),i.push(p)}return Promise.all([Promise.all(r),Promise.all(a),Promise.all(s),Promise.all(o),Promise.all(i)]).then((function(r){for(var a=r[0],s=r[1],o=r[2],i=r[3],c=r[4],l=[],u=0,h=a.length;u<h;u++){var p=a[u],d=s[u],m=o[u],f=i[u],g=c[u];if(void 0!==p){var v;switch(p.updateMatrix(),p.matrixAutoUpdate=!0,N[g.path]){case N.weights:v=e.NumberKeyframeTrack;break;case N.rotation:v=e.QuaternionKeyframeTrack;break;case N.position:case N.scale:default:v=e.VectorKeyframeTrack}var y=p.name?p.name:p.uuid,T=void 0!==f.interpolation?I[f.interpolation]:e.InterpolateLinear,E=[];N[g.path]===N.weights?p.traverse((function(e){!0===e.isMesh&&e.morphTargetInfluences&&E.push(e.name?e.name:e.uuid)})):E.push(y);var w=m.array;if(m.normalized){var x;if(w.constructor===Int8Array)x=1/127;else if(w.constructor===Uint8Array)x=1/255;else if(w.constructor==Int16Array)x=1/32767;else{if(w.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");x=1/65535}for(var M=new Float32Array(w.length),R=0,A=w.length;R<A;R++)M[R]=w[R]*x;w=M}for(R=0,A=E.length;R<A;R++){var S=new v(E[R]+"."+N[g.path],d.array,w,T);"CUBICSPLINE"===f.interpolation&&(S.createInterpolant=function(e){return new b(this.times,this.values,this.getValueSize()/3,e)},S.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(S)}}}var L=n.name?n.name:"animation_"+t;return new e.AnimationClip(L,void 0,l)}))},V.prototype.loadNode=function(t){var n,r=this.json,a=this.extensions,s=this,o=r.nodes[t],i=o.name?s.createUniqueName(o.name):"";return(n=[],void 0!==o.mesh&&n.push(s.getDependency("mesh",o.mesh).then((function(e){var t=s._getNodeRef(s.meshCache,o.mesh,e);return void 0!==o.weights&&t.traverse((function(e){if(e.isMesh)for(var t=0,n=o.weights.length;t<n;t++)e.morphTargetInfluences[t]=o.weights[t]})),t}))),void 0!==o.camera&&n.push(s.getDependency("camera",o.camera).then((function(e){return s._getNodeRef(s.cameraCache,o.camera,e)}))),s._invokeAll((function(e){return e.createNodeAttachment&&e.createNodeAttachment(t)})).forEach((function(e){n.push(e)})),Promise.all(n)).then((function(n){var r;if((r=!0===o.isBone?new e.Bone:n.length>1?new e.Group:1===n.length?n[0]:new e.Object3D)!==n[0])for(var c=0,l=n.length;c<l;c++)r.add(n[c]);if(o.name&&(r.userData.name=o.name,r.name=i),j(r,o),o.extensions&&k(a,r,o),void 0!==o.matrix){var u=new e.Matrix4;u.fromArray(o.matrix),r.applyMatrix4(u)}else void 0!==o.translation&&r.position.fromArray(o.translation),void 0!==o.rotation&&r.quaternion.fromArray(o.rotation),void 0!==o.scale&&r.scale.fromArray(o.scale);return s.associations.set(r,{type:"nodes",index:t}),r}))},V.prototype.loadScene=function(){function t(n,r,a,s){var o=a.nodes[n];return s.getDependency("node",n).then((function(t){return void 0===o.skin?t:s.getDependency("skin",o.skin).then((function(e){for(var t=[],r=0,a=(n=e).joints.length;r<a;r++)t.push(s.getDependency("node",n.joints[r]));return Promise.all(t)})).then((function(r){return t.traverse((function(t){if(t.isMesh){for(var a=[],s=[],o=0,i=r.length;o<i;o++){var c=r[o];if(c){a.push(c);var l=new e.Matrix4;void 0!==n.inverseBindMatrices&&l.fromArray(n.inverseBindMatrices.array,16*o),s.push(l)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',n.joints[o])}t.bind(new e.Skeleton(a,s),t.matrixWorld)}})),t}));var n})).then((function(e){r.add(e);var n=[];if(o.children)for(var i=o.children,c=0,l=i.length;c<l;c++){var u=i[c];n.push(t(u,e,a,s))}return Promise.all(n)}))}return function(n){var r=this.json,a=this.extensions,s=this.json.scenes[n],o=new e.Group;s.name&&(o.name=this.createUniqueName(s.name)),j(o,s),s.extensions&&k(a,o,s);for(var i=s.nodes||[],c=[],l=0,u=i.length;l<u;l++)c.push(t(i[l],o,r,this));return Promise.all(c).then((function(){return o}))}}(),t}(),R=function(t,n){var r,a,s,o,i,c;void 0===n&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),n===e.$document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=t,this.domElement=n,this.enabled=!0,this.target=new e.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:e.MOUSE.ROTATE,MIDDLE:e.MOUSE.DOLLY,RIGHT:e.MOUSE.PAN},this.touches={ONE:e.TOUCH.ROTATE,TWO:e.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return g.phi},this.getAzimuthalAngle=function(){return g.theta},this.listenToKeyEvents=function(e){e.addEventListener("keydown",$),this._domElementKeyEvents=e},this.saveState=function(){l.target0.copy(l.target),l.position0.copy(l.object.position),l.zoom0=l.object.zoom},this.reset=function(){l.target.copy(l.target0),l.object.position.copy(l.position0),l.object.zoom=l.zoom0,l.object.updateProjectionMatrix(),l.dispatchEvent(u),l.update(),m=d.NONE},this.update=(r=new e.Vector3,a=(new e.Quaternion).setFromUnitVectors(t.up,new e.Vector3(0,1,0)),s=a.clone().invert(),o=new e.Vector3,i=new e.Quaternion,c=2*Math.PI,function(){var e=l.object.position;r.copy(e).sub(l.target),r.applyQuaternion(a),g.setFromVector3(r),l.autoRotate&&m===d.NONE&&P(2*Math.PI/60/60*l.autoRotateSpeed),l.enableDamping?(g.theta+=v.theta*l.dampingFactor,g.phi+=v.phi*l.dampingFactor):(g.theta+=v.theta,g.phi+=v.phi);var t=l.minAzimuthAngle,n=l.maxAzimuthAngle;return isFinite(t)&&isFinite(n)&&(t<-Math.PI?t+=c:t>Math.PI&&(t-=c),n<-Math.PI?n+=c:n>Math.PI&&(n-=c),g.theta=t<=n?Math.max(t,Math.min(n,g.theta)):g.theta>(t+n)/2?Math.max(t,g.theta):Math.min(n,g.theta)),g.phi=Math.max(l.minPolarAngle,Math.min(l.maxPolarAngle,g.phi)),g.makeSafe(),g.radius*=y,g.radius=Math.max(l.minDistance,Math.min(l.maxDistance,g.radius)),!0===l.enableDamping?l.target.addScaledVector(T,l.dampingFactor):l.target.add(T),r.setFromSpherical(g),r.applyQuaternion(s),e.copy(l.target).add(r),l.object.lookAt(l.target),!0===l.enableDamping?(v.theta*=1-l.dampingFactor,v.phi*=1-l.dampingFactor,T.multiplyScalar(1-l.dampingFactor)):(v.set(0,0,0),T.set(0,0,0)),y=1,!!(b||o.distanceToSquared(l.object.position)>f||8*(1-i.dot(l.object.quaternion))>f)&&(l.dispatchEvent(u),o.copy(l.object.position),i.copy(l.object.quaternion),b=!1,!0)}),this.dispose=function(){l.domElement.removeEventListener("contextmenu",te),l.domElement.removeEventListener("pointerdown",z),l.domElement.removeEventListener("wheel",Z),l.domElement.removeEventListener("touchstart",Q),l.domElement.removeEventListener("touchend",ee),l.domElement.removeEventListener("touchmove",J),l.domElement.ownerDocument.removeEventListener("pointermove",q),l.domElement.ownerDocument.removeEventListener("pointerup",W),null!==l._domElementKeyEvents&&l._domElementKeyEvents.removeEventListener("keydown",$)};var l=this,u={type:"change"},h={type:"start"},p={type:"end"},d={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},m=d.NONE,f=1e-6,g=new e.Spherical,v=new e.Spherical,y=1,T=new e.Vector3,b=!1,E=new e.Vector2,w=new e.Vector2,x=new e.Vector2,M=new e.Vector2,R=new e.Vector2,A=new e.Vector2,S=new e.Vector2,L=new e.Vector2,_=new e.Vector2;function O(){return Math.pow(.95,l.zoomSpeed)}function P(e){v.theta-=e}function C(e){v.phi-=e}var N,I=(N=new e.Vector3,function(e,t){N.setFromMatrixColumn(t,0),N.multiplyScalar(-e),T.add(N)}),D=function(){var t=new e.Vector3;return function(e,n){!0===l.screenSpacePanning?t.setFromMatrixColumn(n,1):(t.setFromMatrixColumn(n,0),t.crossVectors(l.object.up,t)),t.multiplyScalar(e),T.add(t)}}(),H=function(){var t=new e.Vector3;return function(e,n){var r=l.domElement;if(l.object.isPerspectiveCamera){var a=l.object.position;t.copy(a).sub(l.target);var s=t.length();s*=Math.tan(l.object.fov/2*Math.PI/180),I(2*e*s/r.clientHeight,l.object.matrix),D(2*n*s/r.clientHeight,l.object.matrix)}else l.object.isOrthographicCamera?(I(e*(l.object.right-l.object.left)/l.object.zoom/r.clientWidth,l.object.matrix),D(n*(l.object.top-l.object.bottom)/l.object.zoom/r.clientHeight,l.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),l.enablePan=!1)}}();function U(e){l.object.isPerspectiveCamera?y/=e:l.object.isOrthographicCamera?(l.object.zoom=Math.max(l.minZoom,Math.min(l.maxZoom,l.object.zoom*e)),l.object.updateProjectionMatrix(),b=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),l.enableZoom=!1)}function F(e){l.object.isPerspectiveCamera?y*=e:l.object.isOrthographicCamera?(l.object.zoom=Math.max(l.minZoom,Math.min(l.maxZoom,l.object.zoom/e)),l.object.updateProjectionMatrix(),b=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),l.enableZoom=!1)}function k(e){E.set(e.clientX,e.clientY)}function j(e){M.set(e.clientX,e.clientY)}function B(e){if(1==e.touches.length)E.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);E.set(t,n)}}function G(e){if(1==e.touches.length)M.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);M.set(t,n)}}function V(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);S.set(0,r)}function K(e){if(1==e.touches.length)w.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);w.set(t,n)}x.subVectors(w,E).multiplyScalar(l.rotateSpeed);var r=l.domElement;P(2*Math.PI*x.x/r.clientHeight),C(2*Math.PI*x.y/r.clientHeight),E.copy(w)}function X(e){if(1==e.touches.length)R.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);R.set(t,n)}A.subVectors(R,M).multiplyScalar(l.panSpeed),H(A.x,A.y),M.copy(R)}function Y(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);L.set(0,r),_.set(0,Math.pow(L.y/S.y,l.zoomSpeed)),U(_.y),S.copy(L)}function z(t){if(!1!==l.enabled)switch(t.pointerType){case"mouse":case"pen":!function(t){var n;switch(t.preventDefault(),l.domElement.focus?l.domElement.focus():e.$window.focus(),t.button){case 0:n=l.mouseButtons.LEFT;break;case 1:n=l.mouseButtons.MIDDLE;break;case 2:n=l.mouseButtons.RIGHT;break;default:n=-1}switch(n){case e.MOUSE.DOLLY:if(!1===l.enableZoom)return;!function(e){S.set(e.clientX,e.clientY)}(t),m=d.DOLLY;break;case e.MOUSE.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===l.enablePan)return;j(t),m=d.PAN}else{if(!1===l.enableRotate)return;k(t),m=d.ROTATE}break;case e.MOUSE.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===l.enableRotate)return;k(t),m=d.ROTATE}else{if(!1===l.enablePan)return;j(t),m=d.PAN}break;default:m=d.NONE}m!==d.NONE&&(l.domElement.ownerDocument.addEventListener("pointermove",q),l.domElement.ownerDocument.addEventListener("pointerup",W),l.dispatchEvent(h))}(t)}}function q(e){if(!1!==l.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){if(!1===l.enabled)return;switch(e.preventDefault(),m){case d.ROTATE:if(!1===l.enableRotate)return;!function(e){w.set(e.clientX,e.clientY),x.subVectors(w,E).multiplyScalar(l.rotateSpeed);var t=l.domElement;P(2*Math.PI*x.x/t.clientHeight),C(2*Math.PI*x.y/t.clientHeight),E.copy(w),l.update()}(e);break;case d.DOLLY:if(!1===l.enableZoom)return;!function(e){L.set(e.clientX,e.clientY),_.subVectors(L,S),_.y>0?U(O()):_.y<0&&F(O()),S.copy(L),l.update()}(e);break;case d.PAN:if(!1===l.enablePan)return;!function(e){R.set(e.clientX,e.clientY),A.subVectors(R,M).multiplyScalar(l.panSpeed),H(A.x,A.y),M.copy(R),l.update()}(e)}}(e)}}function W(e){switch(e.pointerType){case"mouse":case"pen":!function(e){if(l.domElement.ownerDocument.removeEventListener("pointermove",q),l.domElement.ownerDocument.removeEventListener("pointerup",W),!1===l.enabled)return;l.dispatchEvent(p),m=d.NONE}()}}function Z(e){!1===l.enabled||!1===l.enableZoom||m!==d.NONE&&m!==d.ROTATE||(e.preventDefault(),l.dispatchEvent(h),function(e){e.deltaY<0?F(O()):e.deltaY>0&&U(O()),l.update()}(e),l.dispatchEvent(p))}function $(e){!1!==l.enabled&&!1!==l.enablePan&&function(e){var t=!1;switch(e.code){case l.keys.UP:H(0,l.keyPanSpeed),t=!0;break;case l.keys.BOTTOM:H(0,-l.keyPanSpeed),t=!0;break;case l.keys.LEFT:H(l.keyPanSpeed,0),t=!0;break;case l.keys.RIGHT:H(-l.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),l.update())}(e)}function Q(t){if(!1!==l.enabled){switch(t.preventDefault(),t.touches.length){case 1:switch(l.touches.ONE){case e.TOUCH.ROTATE:if(!1===l.enableRotate)return;B(t),m=d.TOUCH_ROTATE;break;case e.TOUCH.PAN:if(!1===l.enablePan)return;G(t),m=d.TOUCH_PAN;break;default:m=d.NONE}break;case 2:switch(l.touches.TWO){case e.TOUCH.DOLLY_PAN:if(!1===l.enableZoom&&!1===l.enablePan)return;!function(e){l.enableZoom&&V(e),l.enablePan&&G(e)}(t),m=d.TOUCH_DOLLY_PAN;break;case e.TOUCH.DOLLY_ROTATE:if(!1===l.enableZoom&&!1===l.enableRotate)return;!function(e){l.enableZoom&&V(e),l.enableRotate&&B(e)}(t),m=d.TOUCH_DOLLY_ROTATE;break;default:m=d.NONE}break;default:m=d.NONE}m!==d.NONE&&l.dispatchEvent(h)}}function J(e){if(!1!==l.enabled)switch(e.preventDefault(),m){case d.TOUCH_ROTATE:if(!1===l.enableRotate)return;K(e),l.update();break;case d.TOUCH_PAN:if(!1===l.enablePan)return;X(e),l.update();break;case d.TOUCH_DOLLY_PAN:if(!1===l.enableZoom&&!1===l.enablePan)return;!function(e){l.enableZoom&&Y(e),l.enablePan&&X(e)}(e),l.update();break;case d.TOUCH_DOLLY_ROTATE:if(!1===l.enableZoom&&!1===l.enableRotate)return;!function(e){l.enableZoom&&Y(e),l.enableRotate&&K(e)}(e),l.update();break;default:m=d.NONE}}function ee(e){!1!==l.enabled&&(l.dispatchEvent(p),m=d.NONE)}function te(e){!1!==l.enabled&&e.preventDefault()}l.domElement.addEventListener("contextmenu",te),l.domElement.addEventListener("pointerdown",z),l.domElement.addEventListener("wheel",Z),l.domElement.addEventListener("touchstart",Q),l.domElement.addEventListener("touchend",ee),l.domElement.addEventListener("touchmove",J),this.update()};(R.prototype=Object.create(e.EventDispatcher.prototype)).constructor=R;var A=function(t,n){R.call(this,t,n),this.screenSpacePanning=!1,this.mouseButtons.LEFT=e.MOUSE.PAN,this.mouseButtons.RIGHT=e.MOUSE.ROTATE,this.touches.ONE=e.TOUCH.PAN,this.touches.TWO=e.TOUCH.DOLLY_ROTATE};(A.prototype=Object.create(e.EventDispatcher.prototype)).constructor=A,Page({disposing:!1,platform:null,frameId:-1,onReady(){wx.createSelectorQuery().select("#gl").node().exec((t=>{const n=t[0].node;this.platform=new x(n),e.PLATFORM.set(this.platform);const r=new e.WebGL1Renderer({canvas:n,antialias:!0,alpha:!0}),a=new e.PerspectiveCamera(75,n.width/n.height,.1,1e3),s=new e.Scene,o=new M,i=new R(a,n);i.enableDamping=!0,o.loadAsync("https://dtmall-tel.alicdn.com/edgeComputingConfig/upload_models/1591673169101/RobotExpressive.glb").then((e=>{e.parser=null,e.scene.position.y=-2,s.add(e.scene)})),a.position.z=10,r.outputEncoding=e.sRGBEncoding,s.add(new e.AmbientLight(16777215,1)),s.add(new e.DirectionalLight(16777215,1)),r.setSize(n.width,n.height),r.setPixelRatio(e.$window.devicePixelRatio);const c=()=>{this.disposing||(this.frameId=e.$requestAnimationFrame(c)),i.update(),r.render(s,a)};c()}))},onUnload(){this.disposing=!0,e.$cancelAnimationFrame(this.frameId),e.PLATFORM.dispose()},onTX(e){this.platform.dispatchTouchEvent(e)}});
